# 深入理解DNS原理与部署BIND

## 1、DNS 互联网上最核心的带层级的分布式系统。
### 1.1 递归查询：递归查询是一种DNS 服务器的查询模式，在该模式下DNS 服务器接收到客户机请求，必须使用一个准确的查询结果回复客户机。如果DNS 服务器本地没有存储查询DNS 信息，那么该服务器会询问其他服务器，并将返回的查询结果提交给客户机。  
### 1.2 迭代查询：DNS 服务器会向客户机提供其他能够解析查询请求的DNS 服务器地址，当客户机发送查询请求时，DNS 服务器并不直接回复查询结果，而是告诉客户机另一台DNS 服务器地址，客户机再向这台DNS 服务器提交请求，依次循环直到返回查询的结果为止。

### 1.3 DNS组成部分
* 域名服务器（Name Server）：提供名解析服务的软件，一般监听UDP、TCP的53端口。  
* 解析器（Resolver）： 访问域名服务器的客户端，他负责解析从域名服务器获取的响应，向调用它的应用返回IP地址或者别名等信息。

### 1.4 域名服务器分类
#### 1.4.1 权威域名服务器（Authortative Name Server）：  负责授权域下的域名解析服务，由上级权威域名服务器使用NS记录进行授权。有以下三级权威域名服务器：根域名服务器、顶级域名服务器、二级域名服务器。  
* 根域名服务器（Root Name Server）：最上层权威域名服务器，负责对.com  .cn  .org等顶级域名向下授权。目前有13组这样的服务器。这13组服务器大部分采用Anycast技术，将其分布到不同地区。Anycast 是大型DNS系统中广泛使用的多点部署、分布式方案，对于提高可用性、提高性能、抵抗DDOS有重要作用。

* 顶级域名服务器（Top Level Name Server）：顶级域名服务器有以下两类。  
(1)通用顶级域名（Generic Top Level Domains）服务器。例如服务于 .com .org .info 等授权的域名服务器。    
(2)国家代码顶级域名（Country Code Top Domains）服务器。例如服务于 .uk .cn  .jp 等授权的域名服务器。

* 二级域名服务器（Second  Level Name Server）：这类服务器服务于具体域名解析。

#### 1.4.2 缓存域名服务器（Caching Name Server）:这类域名服务器，负责接收解析器发过来的DNS请求，通过依次查询根域名服务器--->顶级域名服务器--->二级域名服务器来获得DNS的解析条目，然后响应结果发送给解析器，同时根据DNS条目的TTL(Time To LIve，存活时间)值进行缓存。有以下两个用途：
* 用在企业局域网内部，作为该局域网的DNS服务器。这样就可以避免内部用户的主机访问外部非授权的DNS服务器，避免DNS污染等问题
* 用于电信等运营商为其租户提供域名解析服务。
* 用于开放DNS解析服务。
#### 1.4.3 转发域名服务器（Forwarding Name Server）：这类域名服务器。负责接收解析器发过来的DNS请求，转发给指定的上级域名服务器获得DNS的解析条目，然后把响应结果发送给解析器。和缓存域名服务器不同，这类域名服务器不进行任何的缓存，仅仅是转发。

#### 1.4.4  禁用递归查询的原因与方法
* 对于权威域名服务器，打开了递归查询功能，相当于把它配置成了开放的DNS服务器，会造成大量的数据流量，影响正常业务提供，因此，在权威域名服务器上，需要禁用递归查询。  
* recursion no;

### 1.5 构建域名解析缓存
在部署服务器时，很多应用程序需要调用域名解析服务，一般通过配置 `/etc/resolv.conf` 来指定DNS服务器的IP。但如果程序发起的请求量较大，那么服务器就容易被这些DNS服务器禁止访问；同时每次都去访问外部DNS服务器，会导致延时增大，遇到网络问题，还会有解析不成功的情况。在这种情况下，需要配置一个透明的DNS解析缓存服务，以达到如下效果：    
*  优化DNS响应速度。通过缓存DNS的请求结果，后续相同的DNS请求不再通过访问任何外部网络服务器来获得结果，减少了网络访问延时；  
*  减少DNS对外部网络的依赖。在缓存周期内，相同的DNS请求不再发生网络通信行为，可以减少短暂的外部网络不可用导致的影响。
